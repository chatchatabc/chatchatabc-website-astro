---
import { Picture } from "astro-imagetools/components";
import Modal from "../widgets/Modal.astro";
import ContactUs from "./ContactUs.astro";
import Language from "./Language.svelte";
import { utilUrlWithLocale, utilRemoveSpaces } from "../../helpers/commonUtils";
import { t } from "i18next";

const { pathname } = Astro.url;

const navItems = [
  {
    url: utilUrlWithLocale(
      pathname,
      `/#${utilRemoveSpaces(t("navbar.outsourcing"))}`
    ),
    name: t("navbar.outsourcing"),
  },
  {
    url: utilUrlWithLocale(
      pathname,
      `/#${utilRemoveSpaces(t("navbar.software-development"))}`
    ),
    name: t("navbar.software-development"),
  },
  {
    url: utilUrlWithLocale(
      pathname,
      `/#${utilRemoveSpaces(t("navbar.about-us"))}`
    ),
    name: t("navbar.about-us"),
  },
  {
    url: utilUrlWithLocale(pathname, `/${utilRemoveSpaces(t("navbar.blogs"))}`),
    name: t("navbar.blogs"),
  },
];
---

<>
  <!-- Modal -->
  <Modal>
    <ContactUs />
  </Modal>

  <!-- Navbar -->
  <header class="p-2 relative z-[2]">
    <nav
      class="container mx-auto flex flex-wrap justify-between items-center md:flex-nowrap md:gap-8 md:justify-around lg:px-8"
    >
      <!-- Background -->
      <div
        class="absolute z-[1] pointer-events-none bg-white top-0 left-0 w-full h-full md:hidden"
      >
      </div>

      <!-- Logo -->
      <a class="z-[2]" href={utilUrlWithLocale(pathname, "/")}>
        <div class="object-contain w-32 lg:w-44">
          <Picture src="/images/ChatChat.png" layout="fill" alt="test" />
        </div>
      </a>

      <!-- Mobile menu button -->
      <button id="nav-menu-btn" class="z-[2] md:hidden md:pointer-events-none">
        Menu
      </button>

      <!-- Navigation Links -->
      <ul
        id="nav"
        class="max-h-screen absolute bg-white left-0 px-2 top-full py-1 hide-nav flex flex-col w-full text-purple-700 font-medium ml-auto text-xs duration-500 md:px-0 md:static md:items-center md:justify-end md:py-0 md:duration-[0s] md:flex-row md:gap-2 lg:text-base"
      >
        {
          navItems.map((item) => {
            return (
              <li>
                <a
                  href={item.url}
                  class="border-[#79747E] text-[#6750A4] capitalize block px-1 py-2 md:border-2 md:rounded-full md:px-4 hover:bg-[#6750A414]"
                >
                  {item.name}
                </a>
              </li>
            );
          })
        }

        <!-- Contact Us -->
        <li>
          <button
            id="modal-open-btn"
            class="w-full bg-[#E8DEF8] capitalize block px-1 py-2 md:rounded-full md:px-4 md:w-max hover:bg-[#e8d3f899]"
          >
            {t("navbar.contact-us")}
          </button>
        </li>

        <!-- Language Selector -->
        <li>
          <Language url={pathname} client:load />
        </li>
      </ul>
    </nav>
  </header>
</>

<style is:global>
  .hide-nav {
    transform: translateY(-100%);
    pointer-events: none;
  }
  @media (min-width: 768px) {
    .hide-nav {
      transform: translateY(0);
      pointer-events: auto;
    }
  }
</style>

<script>
  const nav = document.getElementById("nav");
  const openMenu = document.getElementById("nav-menu-btn");
  const menuBg = document.getElementById("nav-menu-bg");
  if (openMenu)
    openMenu.addEventListener("click", () => {
      if (nav) {
        nav.classList.toggle("hide-nav");
        if (nav.classList.contains("hide-nav")) openMenu.innerHTML = "Menu";
        else openMenu.innerHTML = "Close";
      }
    });
</script>
