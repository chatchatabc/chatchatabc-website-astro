---
import Section from "@components/widgets/Section.astro";
import Layout from "@layouts/Layout.astro";
import { utilUrlFix } from "@helpers/commonUtils";
import { Icon } from "astro-icon";
import { Img } from "astro-imagetools/components";
import { t, changeLanguage } from "i18next";
import { getCollection } from "astro:content";

changeLanguage("zh");

const blogs = (await getCollection("blogs"))
    .filter((blog) => {
    return blog.data.draft !== true;
})
    .sort((a, b) => b.data.date.getTime() - a.data.date.getTime());
const { pathname } = Astro.url;
---

<Layout title={t("links.blogs") ?? "Blogs"}>
  <Section sectionTitle={t("links.blogs") ?? "blogs"}>
    {
      blogs.length ? (
        <ul class="grid md:grid-cols-2 gap-4 space-y-2 px-2 md:px-4 lg:px-8 md:space-y-0">
          {blogs.map((blog) => {
            const { data, slug } = blog;
            const {
              title,
              date,
              summary,
              author_name,
              author_link,
              author_image,
              summary_image,
            } = data;
            const formattedDate = new Intl.DateTimeFormat("en", {
              dateStyle: "long",
            }).format(date);
            return (
              <li class="border-2 border-primary rounded-xl overflow-hidden">
                <div class="h-full grid lg:grid-cols-5">
                  <div class="h-64 lg:h-full lg:col-span-2">
                    <a href={utilUrlFix(pathname, `/${slug}`)}>
                      <Img
                        src={summary_image ?? "/images/no-image.png"}
                        alt={title ?? "No title"}
                      />
                    </a>
                  </div>
                  <div class="p-4 flex flex-col lg:col-span-3">
                    <p class="text-xl leading-6 font-bold hover:text-neutral-600">
                      <a href={utilUrlFix(pathname, `/${slug}`)}>{title}</a>
                    </p>
                    <p class="text-secondary text-sm py-2 overflow-hidden flex-1 min-h-[150px]">
                      {summary}
                    </p>
                    <div class="mt-auto flex items-center space-x-2">
                      <div class="w-12 rounded-full h-12 border overflow-hidden">
                        {author_link ? (
                          <a
                            class="hover:opacity-75"
                            href={author_link}
                            target="_blank"
                          >
                            {author_image ? (
                              <Img
                                src={author_image}
                                alt={author_name ?? "Anonymous"}
                              />
                            ) : (
                              <Icon class="w-full h-full" name="mdi:user" />
                            )}
                          </a>
                        ) : author_image ? (
                          <Img
                            src={author_image}
                            alt={author_name ?? "Anonymous"}
                          />
                        ) : (
                          <Icon class="w-full h-full" name="mdi:user" />
                        )}
                      </div>
                      <div class="text-xs">
                        <p class="font-medium">
                          {author_link ? (
                            <a
                              class="hover:opacity-75"
                              href={author_link}
                              target="_blank"
                            >
                              {author_name ?? "Anonymous"}
                            </a>
                          ) : (
                            author_name ?? "Anonymous"
                          )}
                        </p>
                        <p class="text-neutral-500">
                          <span class="text-neutral-600 font-medium">
                            Date:
                          </span>{" "}
                          {formattedDate ?? "No Date"}
                        </p>
                      </div>
                    </div>
                  </div>
                </div>
              </li>
            );
          })}
        </ul>
      ) : (
        <div>No blogs yet!</div>
      )
    }
  </Section>
</Layout>
